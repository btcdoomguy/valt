<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:userControls="clr-namespace:Valt.UI.UserControls"
        xmlns:lang="clr-namespace:Valt.UI.Lang"
        xmlns:fixedExpenseEditor="clr-namespace:Valt.UI.Views.Main.Modals.FixedExpenseEditor"
        xmlns:transactionTerms="clr-namespace:Valt.Infra.TransactionTerms;assembly=Valt.Infra"
        mc:Ignorable="d"
        x:Class="Valt.UI.Views.Main.Modals.FixedExpenseEditor.FixedExpenseEditorView"
        Title="{Binding WindowTitle}"
        x:DataType="fixedExpenseEditor:FixedExpenseEditorViewModel"
        d:DesignWidth="550"
        d:DesignHeight="700"
        MaxWidth="550"
        SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        ExtendClientAreaToDecorationsHint="True"
        SystemDecorations="None"
        ExtendClientAreaTitleBarHeightHint="0">
    <Design.DataContext>
        <fixedExpenseEditor:FixedExpenseEditorViewModel />
    </Design.DataContext>
    <Window.KeyBindings>
        <KeyBinding Gesture="Escape" Command="{Binding CloseCommand}" />
    </Window.KeyBindings>
    <Border>
        <StackPanel Orientation="Vertical">
            <userControls:CustomTitleBar Title="{Binding WindowTitle}" TitleBarPressed="CustomTitleBarButtonPressed"
                                         CloseClick="CustomTitleBarCloseClicked" />
            <Border Classes="form-fields-area" Padding="10">
                <StackPanel Orientation="Vertical" Spacing="5">

                    <!-- Name Field -->
                    <StackPanel Classes="form-field">
                        <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Name}" />
                        <AutoCompleteBox x:Name="AutoCompleteTransactionNameBox"
                                         Text="{Binding Name, Mode=TwoWay}"
                                         SelectedItem="{Binding TransactionTermResult, Mode=TwoWay}">
                            <AutoCompleteBox.ItemTemplate>
                                <DataTemplate DataType="transactionTerms:TransactionTermResult">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}" FontWeight="Bold" />
                                        <TextBlock Text="{Binding CategoryName}" FontStyle="Italic" />
                                    </StackPanel>
                                </DataTemplate>
                            </AutoCompleteBox.ItemTemplate>
                        </AutoCompleteBox>
                    </StackPanel>

                    <!-- Category Field -->
                    <StackPanel Classes="form-field">
                        <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Category}" />
                        <ComboBox ItemsSource="{Binding AvailableCategories}"
                                  SelectedItem="{Binding Category}"
                                  HorizontalAlignment="Stretch"
                                  IsTextSearchEnabled="True"
                                  Height="36">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            FontFamily="{DynamicResource MaterialDesign}" FontSize="20"
                                            Text="{Binding Unicode}"
                                            Foreground="{Binding Color, Converter={StaticResource SystemDrawingColorToBrushConverter}}" />
                                        <TextBlock Padding="2, 4, 0, 0" Text="{Binding Name}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>
                    </StackPanel>

                    <Separator Height="1" Margin="0, 5" />

                    <!-- Currency Definition Section -->
                    <Grid ColumnDefinitions="*, *">
                        <StackPanel Grid.Column="0" Classes="form-field">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_CurrencyDefinition}" />
                            <RadioButton GroupName="CurrencyDefinition"
                                         Content="{x:Static lang:language.ManageFixedExpenses_CurrencyDefinition_AttachedToDefaultAccount}"
                                         IsChecked="{Binding IsAttachedToDefaultAccount}" />
                            <RadioButton GroupName="CurrencyDefinition"
                                         Content="{x:Static lang:language.ManageFixedExpenses_CurrencyDefinition_AttachedToCurrency}"
                                         IsChecked="{Binding IsAttachedToCurrency}" />
                        </StackPanel>

                        <!-- Currency selector (when attached to currency) -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding !IsDefaultAccountSelectorVisible}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Currency}" />
                            <ComboBox ItemsSource="{Binding AvailableCurrencies}"
                                      SelectedItem="{Binding Currency}"
                                      HorizontalAlignment="Stretch"
                                      IsTextSearchEnabled="True"
                                      Height="36" />
                        </StackPanel>

                        <!-- Default account selector (when attached to account) -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding IsDefaultAccountSelectorVisible}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_DefaultAccount}" />
                            <ComboBox ItemsSource="{Binding AvailableAccounts}"
                                      SelectedItem="{Binding DefaultAccount}"
                                      HorizontalAlignment="Stretch"
                                      IsTextSearchEnabled="True"
                                      Height="36">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock
                                                FontFamily="{DynamicResource MaterialDesign}" FontSize="20"
                                                Text="{Binding Unicode}"
                                                Foreground="{Binding Color, Converter={StaticResource SystemDrawingColorToBrushConverter}}" />
                                            <TextBlock Padding="2, 4, 0, 0" Text="{Binding Name}" />
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </Grid>

                    <Separator Height="1" Margin="0, 5" />

                    <!-- Period Section Header with Change/Cancel button -->
                    <Grid ColumnDefinitions="*, Auto" Margin="0, 0, 0, 5">
                        <TextBlock Grid.Column="0"
                                   Text="{x:Static lang:language.ManageFixedExpenses_RecurrenceSection}"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="1"
                                Content="{x:Static lang:language.FixedExpenseEditor_ChangeRecurrence}"
                                Classes="link"
                                IsVisible="{Binding ShowChangeRecurrenceButton}"
                                Command="{Binding EnterChangeRecurrenceModeCommand}" />
                        <Button Grid.Column="1"
                                Content="{x:Static lang:language.FixedExpenseEditor_CancelChangeRecurrence}"
                                Classes="link"
                                IsVisible="{Binding ShowCancelChangeRecurrenceButton}"
                                Command="{Binding CancelChangeRecurrenceModeCommand}" />
                    </Grid>

                    <!-- Period Section -->
                    <Grid ColumnDefinitions="*, *">
                        <StackPanel Grid.Column="0" Classes="form-field">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_PeriodRange}" />
                            <ComboBox ItemsSource="{Binding AvailablePeriods}"
                                      SelectedValue="{Binding Period}"
                                      DisplayMemberBinding="{Binding Text}"
                                      SelectedValueBinding="{Binding Value}"
                                      HorizontalAlignment="Stretch"
                                      IsTextSearchEnabled="True"
                                      IsEnabled="{Binding !IsRecurrenceInfoLocked}"
                                      Height="36" />
                        </StackPanel>

                        <!-- Day selector (for monthly/yearly) -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding DisplayDaySelector}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Day}" />
                            <NumericUpDown Increment="1" Minimum="1" Maximum="31" Value="{Binding Day}"
                                           HorizontalContentAlignment="Stretch"
                                           IsEnabled="{Binding !IsRecurrenceInfoLocked}"
                                           Height="36" />
                        </StackPanel>

                        <!-- Day of week selector (for weekly) -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding !DisplayDaySelector}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_DayOfWeek}" />
                            <ComboBox ItemsSource="{Binding AvailableDaysOfWeek}"
                                      SelectedValue="{Binding AdaptedDay}"
                                      DisplayMemberBinding="{Binding Text}"
                                      SelectedValueBinding="{Binding Value}"
                                      HorizontalAlignment="Stretch"
                                      IsTextSearchEnabled="True"
                                      IsEnabled="{Binding !IsRecurrenceInfoLocked}"
                                      Height="36" />
                        </StackPanel>
                    </Grid>

                    <!-- Start Period -->
                    <StackPanel Classes="form-field">
                        <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_StartPeriod}" />
                        <CalendarDatePicker HorizontalAlignment="Left"
                                            SelectedDateFormat="Short"
                                            IsTodayHighlighted="True"
                                            IsEnabled="{Binding !IsRecurrenceInfoLocked}"
                                            Height="36"
                                            SelectedDate="{Binding PeriodStart}" />
                    </StackPanel>

                    <Separator Height="1" Margin="0, 5" />

                    <!-- Amount Definition Section -->
                    <Grid ColumnDefinitions="*, 2*">
                        <StackPanel Grid.Column="0" Classes="form-field">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_AmountDefinition}" />
                            <RadioButton GroupName="AmountDefinition"
                                         Content="{x:Static lang:language.ManageFixedExpenses_AmountDefinition_Fixed}"
                                         IsChecked="{Binding IsFixedAmount}" />
                            <RadioButton GroupName="AmountDefinition"
                                         Content="{x:Static lang:language.ManageFixedExpenses_AmountDefinition_Variable}"
                                         IsChecked="{Binding IsVariableAmount}" />
                        </StackPanel>

                        <!-- Fixed amount input -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding IsFixedSelectorVisible}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Amount_Fixed}" />
                            <userControls:FiatInput
                                FiatValue="{Binding FixedAmount, Mode=TwoWay}"
                                Width="200"
                                HorizontalAlignment="Left" />
                        </StackPanel>

                        <!-- Variable amount range inputs -->
                        <StackPanel Grid.Column="1" Classes="form-field" IsVisible="{Binding !IsFixedSelectorVisible}">
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Amount_From}" />
                            <userControls:FiatInput
                                FiatValue="{Binding RangedAmountMin, Mode=TwoWay}"
                                Width="200"
                                HorizontalAlignment="Left" />
                            <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_Amount_To}" Margin="0, 5, 0, 0" />
                            <userControls:FiatInput
                                FiatValue="{Binding RangedAmountMax, Mode=TwoWay}"
                                Width="200"
                                HorizontalAlignment="Left" />
                        </StackPanel>
                    </Grid>

                    <!-- Hint Box -->
                    <Border Classes="hint-box">
                        <TextBlock Text="{x:Static lang:language.ManageFixedExpenses_AmountDefinition_Hint}" />
                    </Border>

                    <!-- Enabled Checkbox -->
                    <CheckBox Margin="0, 5" Content="{x:Static lang:language.ManageFixedExpenses_Enabled}"
                              IsChecked="{Binding Enabled}" />
                </StackPanel>
            </Border>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="10" Margin="0, 10">
                <Button Width="100" Content="{x:Static lang:language.OkButton}"
                        HorizontalContentAlignment="Center"
                        Command="{Binding OkCommand}" />
                <Button Width="100" Content="{x:Static lang:language.CancelButton}"
                        HorizontalContentAlignment="Center"
                        Command="{Binding CancelCommand}" />
            </StackPanel>
        </StackPanel>
    </Border>
</Window>

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:reports1="clr-namespace:Valt.UI.Views.Main.Tabs.Reports"
             xmlns:userControls="clr-namespace:Valt.UI.UserControls"
             xmlns:avalonia="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
             xmlns:draw="clr-namespace:LiveChartsCore.SkiaSharpView.Drawing.Geometries;assembly=LiveChartsCore.SkiaSharpView"
             xmlns:skiaSharp="clr-namespace:SkiaSharp;assembly=SkiaSharp"
             xmlns:system="clr-namespace:System;assembly=System.Runtime"
             xmlns:immutable="clr-namespace:System.Collections.Immutable;assembly=System.Collections.Immutable"
             xmlns:models="clr-namespace:Valt.UI.Views.Main.Tabs.Reports.Models"
             xmlns:lang="clr-namespace:Valt.UI.Lang"
             xmlns:painting="clr-namespace:LiveChartsCore.SkiaSharpView.Painting;assembly=LiveChartsCore.SkiaSharpView"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="1200"
             MinWidth="900"
             x:Class="Valt.UI.Views.Main.Tabs.Reports.ReportsView"
             x:DataType="reports1:ReportsViewModel">
    <Design.DataContext>
        <reports1:ReportsViewModel />
    </Design.DataContext>
    <Grid>
        <ScrollViewer IsVisible="{Binding !IsSecureModeEnabled}">
        <StackPanel Margin="16">
            <!--Summary-->
            <Expander Classes="section" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" IsExpanded="True">
                <Expander.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="section-header-icon" Text="&#xE1B1;" />
                        <TextBlock Classes="section-header" Text="{x:Static lang:language.Reports_Summary}" />
                    </StackPanel>
                </Expander.Header>
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <!-- Wealth Dashboard -->
                    <Grid MinHeight="150">
                        <Panel IsVisible="{Binding !IsWealthLoading}">
                            <reports1:DashboardDataUserControl DataContext="{Binding WealthData}" />
                        </Panel>
                        <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding IsWealthLoading}" />
                    </Grid>
                    <!-- All Time High Dashboard -->
                    <Grid MinHeight="150">
                        <Panel IsVisible="{Binding !IsAllTimeHighLoading}">
                            <reports1:DashboardDataUserControl DataContext="{Binding AllTimeHighData}" />
                        </Panel>
                        <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding IsAllTimeHighLoading}" />
                    </Grid>
                    <!-- BTC Stack Dashboard -->
                    <Grid MinHeight="150">
                        <Panel IsVisible="{Binding !IsBtcStackLoading}">
                            <reports1:DashboardDataUserControl DataContext="{Binding BtcStackData}" />
                        </Panel>
                        <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding IsBtcStackLoading}" />
                    </Grid>
                    <!-- Statistics Dashboard -->
                    <Grid MinHeight="150">
                        <Panel IsVisible="{Binding !IsStatisticsLoading}">
                            <reports1:DashboardDataUserControl DataContext="{Binding StatisticsData}" />
                        </Panel>
                        <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding IsStatisticsLoading}" />
                    </Grid>
                </StackPanel>
            </Expander>
            <!--Monthly totals-->
            <Expander Classes="section" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" IsExpanded="True">
                <Expander.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="section-header-icon" Text="&#xE6DF;" />
                        <TextBlock Classes="section-header" Text="{x:Static lang:language.Reports_MonthlyTotals}" />
                    </StackPanel>
                </Expander.Header>
                <StackPanel Orientation="Vertical">
                    <userControls:DateCalendarSelector HorizontalContentAlignment="Center"
                                                       Height="60"
                                                       Date="{Binding FilterMainDate}"
                                                       Range="{Binding FilterRange}">
                        <userControls:DateCalendarSelector.AllowedSelectorModes>
                            <userControls:DateCalendarSelectorMode>Year</userControls:DateCalendarSelectorMode>
                            <userControls:DateCalendarSelectorMode>All</userControls:DateCalendarSelectorMode>
                        </userControls:DateCalendarSelector.AllowedSelectorModes>
                    </userControls:DateCalendarSelector>
                    <Grid MinHeight="600">
                        <StackPanel Orientation="Vertical" IsVisible="{Binding !IsMonthlyTotalsLoading}">
                            <Border Background="{DynamicResource Background800Brush}"
                                    BorderBrush="{DynamicResource Background700Brush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10">
                                <avalonia:CartesianChart
                                    x:Name="MonthlyChart"
                                    Series="{Binding MonthlyTotalsChartData.Series}"
                                    XAxes="{Binding MonthlyTotalsChartData.XAxes}"
                                    YAxes="{Binding MonthlyTotalsChartData.YAxes}"
                                    LegendPosition="Top"
                                    LegendTextSize="13"
                                    TooltipTextSize="12"
                                    ZoomMode="X"
                                    Height="480"
                                    Margin="20, 10, 20, 10">
                                </avalonia:CartesianChart>
                            </Border>
                            <DataGrid
                                x:Name="MonthlyTotalsGrid"
                                Margin="0, 10, 0, 0"
                                GridLinesVisibility="All"
                                ItemsSource="{Binding MonthlyReportItems}"
                                IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="{x:Static lang:language.Reports_MonthlyTotals_Date}"
                                                        Binding="{Binding MonthYearFormatted}">
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Bitcoin" Binding="{Binding BtcTotalFormatted}"></DataGridTextColumn>
                                    <DataGridTemplateColumn
                                        Header="{x:Static lang:language.Reports_MonthlyTotals_PreviousMonth}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding BtcMonthlyChangeFormatted}"
                                                           Foreground="{Binding BtcMonthlyChangeColor}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn
                                        Header="{x:Static lang:language.Reports_MonthlyTotals_PreviousYear}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding BtcYearlyChangeFormatted}"
                                                           Foreground="{Binding BtcYearlyChangeColor}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn
                                        Header="{x:Static lang:language.Reports_MonthlyTotals_TotalWealth}"
                                        Binding="{Binding FiatTotalFormatted}">
                                    </DataGridTextColumn>
                                    <DataGridTemplateColumn
                                        Header="{x:Static lang:language.Reports_MonthlyTotals_PreviousMonth}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding FiatMonthlyChangeFormatted}"
                                                           Foreground="{Binding FiatMonthlyChangeColor}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn
                                        Header="{x:Static lang:language.Reports_MonthlyTotals_PreviousYear}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding FiatYearlyChangeFormatted}"
                                                           Foreground="{Binding FiatYearlyChangeColor}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_AllIncomeInFiat}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding AllIncomeInFiatFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_AllExpensesInFiat}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding AllExpensesInFiatFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_Income}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding IncomeFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_Expenses}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding ExpensesFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_BitcoinPurchased}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding BitcoinPurchasedFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_BitcoinSold}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding BitcoinSoldFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_BitcoinIncome}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text" Text="{Binding BitcoinIncomeFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTemplateColumn Header="{x:Static lang:language.Reports_MonthlyTotals_BitcoinExpenses}">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate DataType="models:MonthlyReportItemViewModel">
                                                <TextBlock Classes="only-text"
                                                           Text="{Binding BitcoinExpensesFormatted}">
                                                </TextBlock>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                        <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   IsVisible="{Binding IsMonthlyTotalsLoading}" />
                    </Grid>
                </StackPanel>
            </Expander>
            <!--Categories-->
            <Expander Classes="section" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" IsExpanded="True">
                <Expander.Header>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Classes="section-header-icon" Text="&#xE24B;" />
                        <TextBlock Classes="section-header" Text="{x:Static lang:language.Reports_SpendingByCategories_Title}" />
                    </StackPanel>
                </Expander.Header>
                <StackPanel Orientation="Vertical">
                    <userControls:DateCalendarSelector HorizontalContentAlignment="Center"
                                                       Height="60"
                                                       Date="{Binding CategoryFilterMainDate}"
                                                       Range="{Binding CategoryFilterRange}">
                        <userControls:DateCalendarSelector.AllowedSelectorModes>
                            <userControls:DateCalendarSelectorMode>Month</userControls:DateCalendarSelectorMode>
                            <userControls:DateCalendarSelectorMode>Year</userControls:DateCalendarSelectorMode>
                            <userControls:DateCalendarSelectorMode>All</userControls:DateCalendarSelectorMode>
                        </userControls:DateCalendarSelector.AllowedSelectorModes>
                    </userControls:DateCalendarSelector>
                    <Grid ColumnDefinitions="300, *" MinHeight="600">
                        <StackPanel Grid.Column="0" Orientation="Vertical" Spacing="10" Margin="0, 10, 10, 0">
                            <userControls:CheckboxListSelector
                                Title="{x:Static lang:language.Reports_SpendingByCategories_Accounts}"
                                DisplayMemberPath="Name"
                                MaxListHeight="200"
                                ItemsSource="{Binding AvailableAccounts}"
                                SelectedItems="{Binding SelectedAccounts}" />
                            <userControls:CheckboxListSelector
                                Title="{x:Static lang:language.Reports_SpendingByCategories_Categories}"
                                DisplayMemberPath="Name"
                                MaxListHeight="300"
                                ItemsSource="{Binding AvailableCategories}"
                                SelectedItems="{Binding SelectedCategories}" />
                        </StackPanel>
                        <Panel Grid.Column="1">
                            <Border Background="{DynamicResource Background800Brush}"
                                    BorderBrush="{DynamicResource Background700Brush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="10"
                                    IsVisible="{Binding !IsSpendingByCategoriesLoading}">
                                <ScrollViewer VerticalScrollBarVisibility="Auto"
                                              HorizontalScrollBarVisibility="Disabled"
                                              MaxHeight="600">
                                    <avalonia:CartesianChart x:Name="CategoryBarChart"
                                                             Height="{Binding ExpensesByCategoryChartData.ChartHeight}"
                                                             Series="{Binding ExpensesByCategoryChartData.Series}"
                                                             XAxes="{Binding ExpensesByCategoryChartData.XAxes}"
                                                             YAxes="{Binding ExpensesByCategoryChartData.YAxes}"
                                                             TooltipTextSize="12"
                                                             Margin="20, 10, 20, 10">
                                    </avalonia:CartesianChart>
                                </ScrollViewer>
                            </Border>
                            <TextBlock Text="{x:Static lang:language.Loading}" FontSize="14" Foreground="{DynamicResource Text400Brush}"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       IsVisible="{Binding IsSpendingByCategoriesLoading}" />
                        </Panel>
                    </Grid>
                </StackPanel>
            </Expander>
        </StackPanel>
        </ScrollViewer>
        <!-- Secure Mode Overlay -->
        <Border IsVisible="{Binding IsSecureModeEnabled}"
                Background="{DynamicResource Background800Brush}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch">
            <TextBlock Text="{x:Static lang:language.Reports_SecureModeMessage}"
                       FontSize="18"
                       Foreground="{DynamicResource Text400Brush}"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center" />
        </Border>
    </Grid>
</UserControl>
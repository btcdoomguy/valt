<UserControl x:Name="Root"
             xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:Valt.UI.Lang"
             xmlns:vm1="clr-namespace:Valt.UI.Views.Main.Tabs.Transactions"
             mc:Ignorable="d" d:DesignWidth="1800" d:DesignHeight="900"
             MinWidth="900"
             MinHeight="500"
             x:Class="Valt.UI.Views.Main.Tabs.Transactions.TransactionsView"
             x:DataType="vm1:TransactionsViewModel">
    <Design.DataContext>
        <vm1:TransactionsViewModel />
    </Design.DataContext>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" MinWidth="100" /> <!-- Left Column -->
            <ColumnDefinition Width="*" MinWidth="300" />   <!-- Center Column -->
            <ColumnDefinition Width="2" />
            <ColumnDefinition Width="270" MinWidth="270" />   <!-- Right Column -->
        </Grid.ColumnDefinitions>

        <!-- Left Column -->
        <Panel Grid.Column="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="110" />
                    <RowDefinition Height="*" /> <!-- List -->
                </Grid.RowDefinitions>

                <!-- Total wealth -->
                <Border Grid.Row="0"
                        Background="{DynamicResource Background900Brush}"
                        BorderBrush="{DynamicResource Background700Brush}"
                        Padding="10, 6"
                        BorderThickness="1">
                    <Border.Styles>
                        <Style Selector="TextBlock.wealth-label">
                            <Setter Property="FontSize" Value="13" />
                            <Setter Property="FontWeight" Value="Medium" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                        </Style>
                        <Style Selector="TextBlock.wealth-value">
                            <Setter Property="FontSize" Value="13" />
                            <Setter Property="HorizontalAlignment" Value="Right" />
                            <Setter Property="VerticalAlignment" Value="Center" />
                            <Setter Property="Foreground" Value="{DynamicResource Text100Brush}" />
                        </Style>
                    </Border.Styles>

                    <StackPanel Orientation="Vertical" Spacing="2">
                        <!-- My Stack (BTC) - highlighted -->
                        <Grid ColumnDefinitions="Auto, *" Height="22">
                            <TextBlock Grid.Column="0"
                                       Classes="wealth-label"
                                       Foreground="{DynamicResource Accent300Brush}"
                                       Text="{x:Static local:language.Transactions_MyStack}" />
                            <TextBlock Grid.Column="1"
                                       Classes="wealth-value"
                                       Foreground="{DynamicResource Accent200Brush}"
                                       Text="{Binding DisplayWealthInSats}" />
                        </Grid>

                        <!-- My Other (Fiat) -->
                        <Grid ColumnDefinitions="Auto, *" Height="22">
                            <TextBlock Grid.Column="0"
                                       Classes="wealth-label"
                                       Foreground="{DynamicResource Text400Brush}"
                                       Text="{x:Static local:language.Transactions_MyOther}" />
                            <TextBlock Grid.Column="1"
                                       Classes="wealth-value"
                                       Text="{Binding DisplayWealthInFiat}" />
                        </Grid>

                        <!-- Total in Fiat -->
                        <Grid ColumnDefinitions="Auto, *" Height="22">
                            <TextBlock Grid.Column="0"
                                       Classes="wealth-label"
                                       Foreground="{DynamicResource Text300Brush}"
                                       Text="{x:Static local:language.Transactions_TotalInFiat}" />
                            <TextBlock Grid.Column="1"
                                       Classes="wealth-value"
                                       Text="{Binding DisplayAllWealthInFiat}" />
                        </Grid>

                        <!-- BTC Ratio -->
                        <Grid ColumnDefinitions="Auto, *" Height="22">
                            <TextBlock Grid.Column="0"
                                       Classes="wealth-label"
                                       Foreground="{DynamicResource Text400Brush}"
                                       Text="{x:Static local:language.Transactions_Ratio}" />
                            <TextBlock Grid.Column="1"
                                       Classes="wealth-value"
                                       Foreground="{DynamicResource Accent300Brush}"
                                       Text="{Binding DisplayWealthInBtcRatio}" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Accounts List -->
                <Grid Grid.Row="1" RowDefinitions="30, *" Margin="0, 0, 0, 10">
                    <StackPanel Grid.Row="0" Background="Black">
                        <Button FontSize="12" Classes="transparent link" HorizontalAlignment="Right"
                                HorizontalContentAlignment="Right"
                                VerticalAlignment="Stretch" Command="{Binding SelectAllAccountsCommand}"
                                Content="{x:Static local:language.Transactions_ViewAllAccounts}" />
                    </StackPanel>
                    <ListBox Grid.Row="1"
                             x:Name="AccountsList"
                             Classes="accounts"
                             ItemsSource="{Binding Accounts}"
                             SelectedItem="{Binding SelectedAccount}"
                             SelectionMode="Single">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <!-- Had to create a clickable area using the background transparent to proper render the contextmenu on right click otherwise clickable area doesn't work! -->
                                <Border Padding="3,3" Background="Transparent"
                                        BorderBrush="{DynamicResource Background700Brush}"
                                        BorderThickness="0,0,0,1">
                                    <Grid ColumnDefinitions="44, *" Opacity="{Binding Visible, Converter={StaticResource BoolToOpacityConverter}}">
                                        <Label
                                            Grid.Column="0"
                                            Width="40"
                                            VerticalAlignment="Center"
                                            FontFamily="{DynamicResource MaterialDesign}"
                                            FontSize="28"
                                            Content="{Binding RenderIcon.Unicode}"
                                            Foreground="{Binding RenderIcon.Color, Converter={StaticResource SystemDrawingColorToBrushConverter}}" />
                                        <StackPanel Grid.Column="1" Spacing="-1">
                                            <Label FontSize="14" Padding="0" Content="{Binding Name}" />
                                            <Label FontSize="11" Padding="0"
                                                   Foreground="{DynamicResource Text400Brush}"
                                                   IsVisible="{Binding !IsBtcAccount}"
                                                   Content="{Binding CurrencyDisplayName}" />
                                            <Label FontSize="11" Padding="0"
                                                   Foreground="{DynamicResource Accent200Brush}"
                                                   IsVisible="{Binding IsBtcAccount}"
                                                   Content="{Binding CurrencyDisplayName}" />
                                            <Grid>
                                                <Label FontSize="14" Padding="0"
                                                       HorizontalContentAlignment="Right"
                                                       Content="{Binding FormattedTotal}" />
                                                <Label FontSize="11" Padding="0"
                                                       Margin="0, -14, 0, 0"
                                                       HorizontalContentAlignment="Right"
                                                       Foreground="{DynamicResource Text400Brush}"
                                                       IsVisible="{Binding HasFutureTotal}"
                                                       Content="{Binding FormattedFutureTotal}" />
                                            </Grid>
                                        </StackPanel>
                                    </Grid>
                                    <Border.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="{x:Static local:language.Transactions_Edit}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).EditAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}">
                                            </MenuItem>

                                            <MenuItem Header="{x:Static local:language.Transactions_Hide}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).HideAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}"
                                                      IsVisible="{Binding Visible}">
                                            </MenuItem>
                                            <MenuItem Header="{x:Static local:language.Transactions_Show}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).ShowAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}"
                                                      IsVisible="{Binding IsHidden}">
                                            </MenuItem>
                                            <MenuItem Header="{x:Static local:language.Transactions_Delete}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).DeleteAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}">
                                            </MenuItem>
                                            <Separator></Separator>
                                            <MenuItem Header="{x:Static local:language.Transactions_MoveUp}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).MoveUpAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}">
                                            </MenuItem>
                                            <MenuItem Header="{x:Static local:language.Transactions_MoveDown}"
                                                      Command="{Binding ((vm1:TransactionsViewModel)DataContext).MoveDownAccountCommand, ElementName=Root}"
                                                      CommandParameter="{Binding .}">
                                            </MenuItem>
                                        </ContextMenu>
                                    </Border.ContextMenu>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Grid>

                <Border Grid.Row="1"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        Padding="10"
                        Margin="0,0,10,18">
                    <Button Classes="rounded" Content="&#xE145;" Command="{Binding AddAccountCommand}">
                    </Button>
                </Border>
            </Grid>
        </Panel>

        <!-- Center Column -->

        <ContentControl x:Name="SubContentControl"
                        Content="{Binding SubContent}"
                        Grid.Column="1"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Stretch" />

        <!-- GridSplitter -->
        <GridSplitter Grid.Column="2"
                      Width="2"
                      Background="{DynamicResource Background800Color}"
                      ResizeDirection="Columns"
                      ResizeBehavior="PreviousAndNext" />

        <!-- Right Column -->
        <Panel Grid.Column="3">
            <Grid RowDefinitions="80, *, 4, *" Margin="0, 0, 10, 10">
                <!-- Current Month/Year Header -->
                <TextBlock Grid.Row="0"
                           Text="{Binding CurrentMonthYearDisplay}"
                           FontSize="14"
                           FontWeight="SemiBold"
                           FontFamily="{DynamicResource GeistMono}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Bottom"
                           Margin="0, 0, 0, 8" />

                <!-- Fixed Expenses Panel -->
                <vm1:FixedExpensesPanelView Grid.Row="1" x:Name="FixedExpensesPanel" />

                <!-- GridSplitter between panels -->
                <GridSplitter Grid.Row="2"
                              Height="4"
                              Background="Transparent"
                              ResizeDirection="Rows"
                              ResizeBehavior="PreviousAndNext" />

                <!-- Goals Panel -->
                <vm1:GoalsPanelView Grid.Row="3" x:Name="GoalsPanel" />
            </Grid>
        </Panel>
    </Grid>
</UserControl>

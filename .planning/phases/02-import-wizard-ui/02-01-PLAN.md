---
phase: 02-import-wizard-ui
plan: 01
type: execute
---

<objective>
Create the Import Wizard modal infrastructure with step navigation and registration.

Purpose: Establish the wizard framework that Phase 2 Plan 2 will populate with step content.
Output: Working modal that opens from menu, displays step indicator, and allows navigation between 5 empty steps.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-csv-parser-template/01-01-SUMMARY.md

**Tech stack available:** CsvHelper, CommunityToolkit.Mvvm, Avalonia 11.3
**Established patterns:** ValtModalViewModel, ApplicationModalNames enum, ModalFactory registration
**Key files:**
@src/Valt.UI/Base/ValtModalViewModel.cs
@src/Valt.UI/Views/ApplicationModalNames.cs
@src/Valt.UI/Extensions.cs
@src/Valt.UI/Views/Main/Modals/Settings/SettingsViewModel.cs (TabControl pattern reference)
@src/Valt.UI/Views/Main/Modals/InitialSelection/InitialSelectionViewModel.cs (file picker pattern)
@src/Valt.Infra/Services/CsvImport/ICsvImportParser.cs
@src/Valt.Infra/Services/CsvImport/CsvImportResult.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ImportWizardViewModel with step navigation</name>
  <files>src/Valt.UI/Views/Main/Modals/ImportWizard/ImportWizardViewModel.cs</files>
  <action>
Create ImportWizardViewModel extending ValtModalViewModel with:
- WizardStep enum: FileSelection = 0, AccountMapping = 1, CategoryPreview = 2, Summary = 3, Progress = 4
- [ObservableProperty] WizardStep _currentStep = WizardStep.FileSelection
- [ObservableProperty] bool _canGoBack, _canGoNext (computed based on CurrentStep and step validation)
- [ObservableProperty] string _nextButtonText (changes to "Import" on Summary step)
- [RelayCommand] GoNext() - advances step or starts import on Summary
- [RelayCommand] GoBack() - goes to previous step
- [RelayCommand] Cancel() - closes modal
- Design-time constructor for AXAML preview
- DI constructor injecting ICsvImportParser, ICsvTemplateGenerator, IAccountQueries, ICategoryQueries

Step validation properties (to be implemented in Plan 02):
- [ObservableProperty] CsvImportResult? _parseResult (populated after file selection)
- [ObservableProperty] string? _selectedFilePath
- [ObservableProperty] bool _isFileSelected (computed from selectedFilePath)

Use [NotifyPropertyChangedFor] to update CanGoBack/CanGoNext when CurrentStep changes.
  </action>
  <verify>dotnet build src/Valt.UI/Valt.UI.csproj succeeds without errors</verify>
  <done>ViewModel compiles with step navigation infrastructure, ready for view binding</done>
</task>

<task type="auto">
  <name>Task 2: Create ImportWizardView.axaml with step indicator</name>
  <files>src/Valt.UI/Views/Main/Modals/ImportWizard/ImportWizardView.axaml, src/Valt.UI/Views/Main/Modals/ImportWizard/ImportWizardView.axaml.cs</files>
  <action>
Create ImportWizardView.axaml extending ValtBaseWindow (like other modals) with:
- CustomTitleBar with localized title "Import Transactions"
- Step indicator header showing 5 steps as horizontal StackPanel with numbered circles/labels (1. File, 2. Accounts, 3. Categories, 4. Summary, 5. Import)
- Current step highlighted with accent color, completed steps with checkmark
- Main content area using ContentControl with DataTemplates switching on CurrentStep enum
- Initially empty DataTemplates for each step (placeholder TextBlocks like "Step 1: File Selection")
- Bottom button bar with Back/Next/Cancel buttons bound to commands
- Back button visibility bound to CanGoBack
- Next button text bound to NextButtonText
- Modal size: Width="700" Height="550"

Code-behind (ImportWizardView.axaml.cs):
- Inherit from ValtBaseWindow
- TitleBar event handlers (copy from existing modals like SettingsView.axaml.cs)

Use x:DataType="importWizard:ImportWizardViewModel" for compiled bindings.
  </action>
  <verify>dotnet build src/Valt.UI/Valt.UI.csproj succeeds, AXAML compiles without binding errors</verify>
  <done>View displays step indicator and placeholder content, buttons respond to commands</done>
</task>

<task type="auto">
  <name>Task 3: Register modal and add menu trigger</name>
  <files>src/Valt.UI/Views/ApplicationModalNames.cs, src/Valt.UI/Extensions.cs, src/Valt.UI/Views/Main/MainViewModel.cs, src/Valt.UI/Lang/language.resx, src/Valt.UI/Lang/language.pt-BR.resx</files>
  <action>
1. Add ImportWizard = 18 to ApplicationModalNames enum

2. In Extensions.cs:
   - Add using for Valt.UI.Views.Main.Modals.ImportWizard
   - Add services.AddTransient&lt;ImportWizardViewModel&gt;()
   - Add case to factory switch: ApplicationModalNames.ImportWizard => new ImportWizardView() { DataContext = services.GetRequiredService&lt;ImportWizardViewModel&gt;() }

3. In MainViewModel.cs:
   - Add [RelayCommand] OpenImportWizard() that creates and shows the modal via _modalFactory
   - Add menu item in the existing menu dropdown (find where Settings/About are triggered)

4. Add localization strings to both .resx files:
   - ImportWizard_Title: "Import Transactions" / "Importar Transacoes"
   - ImportWizard_Step1: "File" / "Arquivo"
   - ImportWizard_Step2: "Accounts" / "Contas"
   - ImportWizard_Step3: "Categories" / "Categorias"
   - ImportWizard_Step4: "Summary" / "Resumo"
   - ImportWizard_Step5: "Import" / "Importar"
   - ImportWizard_Back: "Back" / "Voltar"
   - ImportWizard_Next: "Next" / "Proximo"
   - ImportWizard_Import: "Import" / "Importar"
   - Menu_ImportTransactions: "Import Transactions..." / "Importar Transacoes..."
  </action>
  <verify>dotnet build Valt.sln succeeds, application launches and menu item appears, clicking opens import wizard modal</verify>
  <done>Import wizard accessible from menu, modal opens showing step 1 placeholder with working navigation buttons</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `dotnet build Valt.sln` succeeds without errors
- [ ] Application launches without runtime errors
- [ ] Menu item "Import Transactions..." visible in appropriate menu location
- [ ] Clicking menu item opens Import Wizard modal
- [ ] Step indicator shows 5 steps with step 1 highlighted
- [ ] Next button navigates through steps 1→2→3→4→5
- [ ] Back button navigates backwards (hidden on step 1)
- [ ] Cancel button closes modal
- [ ] Next button text changes to "Import" on step 4 (Summary)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/C# errors or warnings introduced
- Import wizard modal infrastructure ready for step content implementation
</success_criteria>

<output>
After completion, create `.planning/phases/02-import-wizard-ui/02-01-SUMMARY.md`
</output>
